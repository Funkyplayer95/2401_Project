<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 변경</title>
    <link rel="stylesheet" type="text/css" th:href="@{/changepwstyle.css}">
</head>

<body>
    <script th:inline="javascript">
        /*<![CDATA[*/
        var message = /*[[${successMessage}]]*/ 'default message';
        var error = /*[[${errorMessage}]]*/ 'default error';
        if (message) { alert(message); }
        if (error) { alert(error); }
        /*]]>*/
    </script>
    <div class="password-change-container">
        <h2>비밀번호 변경</h2>

        <form action="updatePw" method="post">
            <input type="hidden" name="idvalue" id="idvalue" th:value="${user.userId}">
            <div class="form-group">
                <label for="orignPw">현재 비밀번호:</label>
                <input type="password" id="orignPw" name="orignPw" required>
            </div>
            <div class="form-group">
                <li>
                    <label for="newPw">새 비밀번호:</label>
                    <input type="password" id="newPw" name="newPw" onblur="pw_Blur()" required>
                </li>
                <li class="error pw_error">특수문자 & 영어 포함 / 8자리 이상 입력해야합니다.</li>
            </div>
            <div class="form-group">
                <li>
                    <label for="re_newPw">비밀번호 확인:</label>
                    <input type="password" id="re_newPw" name="re_newPw" onblur="re_pw_Blur()" required>
                </li>
                <li class="error re_pw_error">비밀번호와 일치하지 않습니다</li>
            </div>
            <button type="submit" id="change">변경하기</button>
        </form>
    </div>
    <script>
        const input_pw = document.querySelector('input[name=newPw]');

        document.getElementById('change').addEventListener('click', function () {
        localStorage.setItem('idvalue', document.getElementById('idvalue').value);
        window.location.href = 'http://localhost:8001/mypage?idvalue=' + localStorage.getItem('idvalue');
    });

        function pw_Blur() { // password 값
            const passwordValue = input_pw.value;
            const have_english_specialChar = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-])/.test(passwordValue);

            if (passwordValue.length < 8 || !have_english_specialChar) { //8자리 미만이거나, 영어 숫자 특수문자가 포함안될경우 error표시
                pw_error.style.display = 'block';
                return;
            } else { pw_error.style.display = 'none'; }
        }

        function re_pw_Blur() { // 비밀번호 확인 값
            const passwordValue = input_pw.value;
            const re_passwordValue = input_re_pw.value;
            if (re_passwordValue !== passwordValue) {
                re_pw_error.style.display = 'block';
                return;
            } else { re_pw_error.style.display = 'none'; }
        }

    </script>
</body>

</html>